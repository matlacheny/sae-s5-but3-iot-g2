
<!--

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espace Patient</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f8f8;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 22px;
            color: #2b4c7e;
        }

        header img {
            height: 50px;
        }

        .container {
            padding: 20px;
        }

        .infos {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }

        .bloc-info {
            flex: 1;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .bloc-info h2 {
            margin-top: 0;
            color: #1e3d59;
        }

        h2.section-title {
            margin-top: 40px;
            color: #1e3d59;
        }

        .pdf-viewer {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-bottom: 40px;
        }

        .calendar {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Placeholder calendrier simple */
        table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ddd;
        }

        .highlight {
            background-color: #b5d5ff;
            font-weight: bold;
        }
        </style>

    //=== STYLE + MODAL POUR DETAILS DES PRISES === 
    <style>
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-box {
            background: #fff;
            padding: 20px;
            width: 400px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .modal-box h3 {
            margin-top: 0;
            font-size: 20px;
            margin-bottom: 10px;
        }
        .close-btn {
            float: right;
            cursor: pointer;
            font-size: 22px;
            margin-top: -10px;
        }
        .medoc-item {
            background: #f2f6ff;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #4a73d9;
        }
    </style>
</head>
<body>

<header>
    <img src="../image/logoMedibox.png" alt="Logo Medibox">
        <h1>Espace Patient</h1>

</header>

<div class="container">

    <div class="infos">
        <div class="bloc-info">
            <h2>Médecin</h2>
            <p>Nom : </p>
            <p>Prénom : </p>
            <p>Date de naissance : </p>
            <p>Sexe :  </p>
            <p>Adresse : </p>
            <p>Email :  </p>
        </div>

        <div class="bloc-info">
            <h2>Aide-soignant</h2>
            
            <div id="info-aide-soignant" style="display: none;">
                <p>Nom : <span id="as-nom"></span></p>
                <p>Prénom : <span id="as-prenom"></span></p>
                <p>Date de naissance : <span id="as-naissance"></span></p>
                <p>Sexe : <span id="as-sexe"></span></p>
                <p>Adresse : <span id="as-adresse"></span></p>
                <p>Email : <span id="as-email"></span></p>

                <button id="btn-changer-as" 
                        style="margin-top: 15px; width: 100%; padding: 8px; background-color: #f0ad4e; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                    Changer d'aide-soignant
                </button>
            </div>

            <div id="btn-assign-aide-soignant">
                <p style="color: #666; font-style: italic; margin-bottom: 15px;">
                    Aucun aide-soignant n'est encore assigné à votre dossier.
                </p>
                <button onclick="window.location.href='AssignerAideSoignant.html'" 
                        style="padding: 10px 20px; background-color: #4a73d9; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
                    Assigner un aide-soignant
                </button>
            </div>
        </div>
    </div>

    <h2 class="section-title">Prescription</h2>
    <iframe class="pdf-viewer" src=" //URL du PDF chargé depuis la BD //"></iframe>

    <h2 class="section-title">Suivi du traitement</h2>
    <div class="calendar">
        <div id="os-calendar" class="os-calendar"></div>
    </div>

    <script>
        const calendarContainer = document.getElementById("os-calendar");

        const date = new Date();
        let month = date.getMonth();
        let year = date.getFullYear();

        function renderCalendar(m, y) {
            // met à jour les variables globales
            month = m; year = y;

            const current = new Date(y, m, 1);
            const monthName = current.toLocaleString('fr-FR', { month: 'long', year: 'numeric' });

            const firstDay = new Date(y, m, 1).getDay();
            const daysInMonth = new Date(y, m + 1, 0).getDate();

            const weekDays = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'];

            let html = `
                <div class="cal-header">
                    <button class="nav-btn" id="prev">◀</button>
                    <span class="month-title">${monthName.charAt(0).toUpperCase() + monthName.slice(1)}</span>
                    <button class="nav-btn" id="next">▶</button>
                </div>
                <div class="cal-grid">
                    ${weekDays.map(d => `<div class='day-name'>${d}</div>`).join('')}
            `;

            // correction du décalage (1 = lundi)
            let offset = firstDay === 0 ? 6 : firstDay - 1;
            for (let i = 0; i < offset; i++) html += `<div class='empty'></div>`;

            for (let d = 1; d <= daysInMonth; d++) {
                html += `<div class='day' data-day='${d}' data-month='${m}' data-year='${y}'>${d}</div>`;
            }

            html += `</div>`;
            calendarContainer.innerHTML = html;

            // attach nav handlers après rendu
            document.getElementById('prev').addEventListener('click', () => changeMonth(-1));
            document.getElementById('next').addEventListener('click', () => changeMonth(1));
        }

        function changeMonth(step) {
            let m = month + step;
            let y = year;
            if (m < 0) { m = 11; y--; }
            if (m > 11) { m = 0; y++; }
            renderCalendar(m, y);
        }

        // === FENETRE MODALE POUR DETAILS ===
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.style.display = 'none';
        modal.innerHTML = `
            <div class='modal-box'>
                <span class='close-btn' id='modal-close'>&times;</span>
                <h3 id='modal-date'></h3>
                <div id='modal-content'>Chargement...</div>
            </div>
        `;
        document.body.appendChild(modal);

        // fermer modal
        document.getElementById('modal-close').addEventListener('click', () => { modal.style.display = 'none'; });

        // délégation d'événement sur le container du calendrier
        calendarContainer.addEventListener('click', function (e) {
            const target = e.target.closest('.day');
            if (!target) return;
            const day = parseInt(target.getAttribute('data-day'));
            const m = parseInt(target.getAttribute('data-month'));
            const y = parseInt(target.getAttribute('data-year'));
            openDetails(day, m, y);
        });
        
        // ----- Page assigner un aide soignant ------

        // Configuration API
        const API_KEY = "9769a0eab09284d4bfeef45e4103642cf00b1b17f15f65afeb4f336890e37e63";
        const API_URL_BASE = "https://apidatabasesae-aee3egcmdke2b6a2.germanywestcentral-01.azurewebsites.net/api";

        // On récupère l'ID du patient dans l'URL (ou '1' par défaut pour les tests)
        const urlParams = new URLSearchParams(window.location.search);
        const idPatient = urlParams.get('idPatient') || 'pat1';

        async function chargerDonneesPatient() {
            try {
                // ... (début de la fonction identique) ...
                const response = await fetch(`${API_URL_BASE}/patients/${idPatient}`, {
                    headers: { "api_key": API_KEY }
                });
                
                if (!response.ok) throw new Error("Erreur récupération patient");
                const patient = await response.json();

                const divInfo = document.getElementById('info-aide-soignant');
                const divBtn = document.getElementById('btn-assign-aide-soignant');

                // Mise à jour du bouton "Assigner" (cas vide)
                const btnAssigner = divBtn.querySelector('button');
                if(btnAssigner) {
                    btnAssigner.onclick = () => window.location.href = `AssignerAideSoignant.html?idPatient=${idPatient}`;
                }

                // 3. Vérifier si un aide-soignant est déjà assigné
                if (patient.fk_aide_soignant) {
                    // OUI -> On affiche les infos
                    divInfo.style.display = 'block';
                    divBtn.style.display = 'none';
                    chargerInfoAideSoignant(patient.fk_aide_soignant);

                    // --- AJOUT : Activation du bouton "Changer" ---
                    const btnChanger = document.getElementById('btn-changer-as');
                    if (btnChanger) {
                        btnChanger.onclick = () => window.location.href = `AssignerAideSoignant.html?idPatient=${idPatient}`;
                    }

                } else {
                    // NON -> On affiche le bouton assigner standard
                    divInfo.style.display = 'none';
                    divBtn.style.display = 'block';
                }
            } catch (error) {
                console.error(error);
            }
        }

        async function chargerInfoAideSoignant(idAS) {
            try {
                const response = await fetch(`${API_URL_BASE}/aidesoignants/${idAS}`, {
                    headers: { "api_key": API_KEY }
                });
                const asData = await response.json();

                // Remplissage des champs HTML
                document.getElementById('as-nom').textContent = asData.nomFamille || asData.nom || '';
                document.getElementById('as-prenom').textContent = asData.prenom || '';
                document.getElementById('as-email').textContent = asData.adresse_electronique || '';
                document.getElementById('as-adresse').textContent = asData.adresse_postale || '';
                
                // Si vous avez ajouté des champs date/sexe dans le HTML, ajoutez-les ici :
                if(document.getElementById('as-naissance')) document.getElementById('as-naissance').textContent = asData.date_naissance || '';
                if(document.getElementById('as-sexe')) document.getElementById('as-sexe').textContent = asData.sexe || '';

            } catch (error) {
                console.error("Erreur chargement AS", error);
            }
        }

        // Lancer la récupération des données
        chargerDonneesPatient();


        // pour quand on clique sur une date du calendrier  enlever la Popup et affciher à droite comme pour le prodil Aide Soignants 
        function openDetails(day, month, year) {
            modal.style.display = "flex";
            document.getElementById('modal-date').innerText = `Détails du ${day}/${month + 1}/${year}`;

            // Placeholder — plus tard on remplacera par le fetch() vers notre backend
            const placeholder = `
                <div class='medoc-item'>
                    <b>Doliprane</b> – 08:00<br>
                    Quantité : 1<br>
                    Compartiment : 2
                </div>
                <div class='medoc-item'>
                    <b>Ibuprofène</b> – 14:00<br>
                    Quantité : 1<br>
                    Compartiment : 1                   
                </div>
            `;
            document.getElementById('modal-content').innerHTML = placeholder;
        }

        // rendu initial
        renderCalendar(month, year);
    </script>


//Style css pour le calendrier//
    <style>
        .os-calendar {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            width: 350px;
        }
        .cal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
        }
        .nav-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
        }
        .cal-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            text-align: center;
        }
        .day-name {
            font-weight: bold;
            color: #444;
        }
        .empty {
            height: 40px;
        }
        .day {
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            background: #f2f2f2;
            transition: 0.2s;
        }
        .day:hover {
            background: #cfe3ff;
        }
    </style>
</div>

</body>
</html>
-->