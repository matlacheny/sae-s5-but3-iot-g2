<!---
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Espace Aide-Soignant</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f8f8;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 22px;
            color: #2b4c7e;
        }

        header img {
            height: 50px;
        }

        .container {
            padding: 20px;
        }

        .infos {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }

        .bloc-info {
            flex: 1;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .bloc-info h2 {
            margin-top: 0;
            color: #1e3d59;
        }

        h2.section-title {
            margin-top: 40px;
            color: #1e3d59;
        }

        .pdf-viewer {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-bottom: 40px;
        }

        .calendar {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Placeholder calendrier simple */
        table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ddd;
        }

        .highlight {
            background-color: #b5d5ff;
            font-weight: bold;
        }

 /*  pour l affichage des details quand on clique sur une date du calendrier */

 .details-panel {
    width: 360px;
    background: #ffffff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    min-height: 200px;
    transition: transform 200ms ease, opacity 200ms ease;

}

.details-panel h3 {
    margin-top: 0;
    color: #1e3d59;
    font-size: 18px;

}

.details-panel .empty {
    color: #888;
    font-style: italic;
}

.empty-text {
    color: #888;
    font-style: italic;
}

.medoc-item {
    background: #f2f6ff;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 10px;
    border-left: 4px solid #4a73d9;
}


.os-calendar {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            width: 350px;
        }
        .cal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
        }
        .nav-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
        }
        .cal-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            text-align: center;
        }
        .day-name {
            font-weight: bold;
            color: #444;
        }
        .empty {
            height: 40px;
        }
        .day {
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            background: #f2f2f2;
            transition: 0.2s;
        }
        .day:hover {
            background: #cfe3ff;
        }
    

/* Style pour les compartiments de la boite */
 /* Configuration boite */
.box-config {
display: flex;
flex-direction: column;
align-items: center;
gap: 10px;
margin-bottom: 30px;
}


.compartiments-row {
display: flex;
gap: 10px;
}


.compartiment {
width: 140px;
height: 160px;
background-color: #cfe3ff;
border: 2px solid #4a73d9;
border-radius: 8px;
display: flex;
flex-direction: column;  /* pour aligner les inputs verticalement */
align-items: center;
justify-content: flex-start; /* pour le titre en haut */
font-weight: bold;
font-size: 16px;
/*cursor: text;*/
 padding: 5px;
 box-sizing: border-box;
}

.compartiment-title {
    font-size: 14px;
    font-weight: bold;
    margin-bottom: 6px;
}

.compartiment input {
    width: 90%;        /* prend presque toute la largeur du compartiment */
    margin: 3px 0;
    padding: 4px;
    font-size: 12px;
    border-radius: 4px;
    border: 1px solid #999;
    box-sizing: border-box;
}


.compartiments-row {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
}

/* Alertes */
.alert-title { 
    color: red;
    font-weight: bold;
     margin-bottom: 10px; 
    }

.alert-box { 
    background: #ffe6e6; 
    padding: 15px;
    border-radius: 12px; 
    /*min-height: 70px;*/
    min-width: 600px;


     }

/* pour remettre ça à gauche */     

.alert-title,
.alert-box {
    align-self: flex-start;
}

</style>
</head>

<body>

<header>
    <img src="../image/logoMedibox.png" alt="Logo Medibox">
        <h1> Espace Medecin </h1>
</header>

<div class="container">

    <div class="infos">
        <div class="bloc-info">
           <h2>Patient</h2>
            <p>Nom : <span id="p-nom"></span></p>
            <p>Prénom : <span id="p-prenom"></span></p>
            <p>Date de naissance : <span id="p-ddn"></span></p>
            <p>Sexe : <span id="p-sexe"></span></p>
            <p>Adresse postale : <span id="p-adresse"></span></p>
            <p>Adresse électronique : <span id="p-mail"></span></p>
        </div>

        <div class="bloc-info">
            <h2>Aide-Soignant</h2>
            <p>Nom : <span id="as-nom"></span></p>
            <p>Prénom : <span id="as-prenom"></span></p>
            <p>Date de naissance : <span id="as-ddn"></span></p>
            <p>Sexe : <span id="as-sexe"></span></p>
            <p>Adresse postale : <span id="as-adresse"></span></p>
            <p>Adresse électronique : <span id="as-mail"></span></p>
        </div>
    </div>

    <h2 class="section-title">Prescription</h2>
<button class="BouttonAjoutPrescription" type="button"> Ajouter une prescription </button>    
<button class="BouttonAjoutPrescription" type="button"> Supprimer </button>    
</div>
</br> 


<iframe class="pdf-viewer" src=" // URL du PDF chargé depuis la BD //"></iframe>

    <h2 class="section-title">Suivi du traitement</h2>
 
 <div style="display: flex; gap: 20px; align-items: flex-start;">

 // CALENDRIER //
  <div class="calendar" id="calendar-wrapper">
      <div id="os-calendar" class="os-calendar"></div>
  </div>

 // PANNEAU DE DETAILS (caché par défaut) //
  <aside id="details-panel" class="details-panel" aria-hidden="true" style="display:none;">
      <h3 id="details-title">Détails du jour</h3>
      <div id="details-content"></div>
  </aside>
</div>


</div>
    <script>


// --- Récupération de l'ID patient depuis l'URL ---
const params = new URLSearchParams(window.location.search);
const idPatient = params.get("id");

if (!idPatient) {
    alert("Aucun patient sélectionné !");
}

const API_KEY = "9769a0eab09284d4bfeef45e4103642cf00b1b17f15f65afeb4f336890e37e63";
const API_URL_BASE = "https://apidatabasesae-aee3egcmdke2b6a2.germanywestcentral-01.azurewebsites.net/api";

async function chargerInfos() {
    try {
        // ---- 1. Charger infos patient ----
        const repPatient = await fetch(`${API_URL_BASE}/patients/${idPatient}`, {
            headers: { "api_key": API_KEY }
        });

        if (!repPatient.ok) throw new Error("Patient introuvable");

        const patient = await repPatient.json();

        // ---- remplir infos patient ----
        document.getElementById("p-nom").textContent = patient.nomFamille;
        document.getElementById("p-prenom").textContent = patient.prenom;
        document.getElementById("p-ddn").textContent = patient.date_naissance;
        document.getElementById("p-sexe").textContent = patient.sexe;
        document.getElementById("p-mail").textContent = patient.adresse_electronique;
        document.getElementById("p-adresse").textContent = patient.adresse_postale;

        // ---- 2. Vérifier si un aide-soignant est assigné ----
        if (!patient.fk_aide_soignant) {
            document.getElementById("as-nom").textContent = "Aucun aide-soignant assigné";
            return;
        }

        // ---- 3. Charger infos aide-soignant ----
        const repAS = await fetch(`${API_URL_BASE}/aidesoignants/${patient.fk_aide_soignant}`, {
            headers: { "api_key": API_KEY }
        });

        if (!repAS.ok) throw new Error("Aide-soignant introuvable");

        const aide = await repAS.json();

        // ---- remplir infos aide-soignant ----
       document.getElementById("as-nom").textContent = aide.nomFamille;
        document.getElementById("as-prenom").textContent = aide.prenom;
        document.getElementById("as-ddn").textContent = aide.date_naissance;
        document.getElementById("as-sexe").textContent = aide.sexe;
        document.getElementById("as-mail").textContent = aide.adresse_electronique;
        document.getElementById("as-adresse").textContent = aide.adresse_postale;

    } catch (err) {
        console.error(err);
        alert("Erreur lors du chargement du patient");
    }
}

chargerInfos();

/* pour calendrier */
        const calendarContainer = document.getElementById("os-calendar");

        const date = new Date();
        let month = date.getMonth();
        let year = date.getFullYear();

        function renderCalendar(m, y) {
            // met à jour les variables globales
            month = m; year = y;

            const current = new Date(y, m, 1);
            const monthName = current.toLocaleString('fr-FR', { month: 'long', year: 'numeric' });

            const firstDay = new Date(y, m, 1).getDay();
            const daysInMonth = new Date(y, m + 1, 0).getDate();

            const weekDays = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'];

            let html = `
                <div class="cal-header">
                    <button class="nav-btn" id="prev">◀</button>
                    <span class="month-title">${monthName.charAt(0).toUpperCase() + monthName.slice(1)}</span>
                    <button class="nav-btn" id="next">▶</button>
                </div>
                <div class="cal-grid">
                    ${weekDays.map(d => `<div class='day-name'>${d}</div>`).join('')}
            `;

            // correction du décalage (1 = lundi)
            let offset = firstDay === 0 ? 6 : firstDay - 1;
            for (let i = 0; i < offset; i++) html += `<div class='empty'></div>`;

            for (let d = 1; d <= daysInMonth; d++) {
                html += `<div class='day' data-day='${d}' data-month='${m}' data-year='${y}'>${d}</div>`;
            }

            html += `</div>`;
            calendarContainer.innerHTML = html;

            // attach nav handlers après rendu
            document.getElementById('prev').addEventListener('click', () => changeMonth(-1));
            document.getElementById('next').addEventListener('click', () => changeMonth(1));
        }

        function changeMonth(step) {
            let m = month + step;
            let y = year;
            if (m < 0) { m = 11; y--; }
            if (m > 11) { m = 0; y++; }
            // cacher panneau lors du changement de mois
            document.getElementById('details-panel').style.display = 'none';
            renderCalendar(m, y);
        }



// délégation d'événement sur le container du calendrier
calendarContainer.addEventListener('click', function (e) {
    const target = e.target.closest('.day');
    if (!target) return;
    const day = parseInt(target.getAttribute('data-day'), 10);
    const m = parseInt(target.getAttribute('data-month'), 10);
    const y = parseInt(target.getAttribute('data-year'), 10);
    openDetails(day, m, y);
});



function openDetails(day, month, year) {
    // titre format jour uniquement ( peux remplacer par `${day}/${month+1}/${year}` si tu veux)
    const title = `Détails du ${day}/${month}/${year}`;

    // afficher le panneau (il était caché par défaut)
    const panel = document.getElementById('details-panel');
    panel.style.display = 'block';
    panel.setAttribute('aria-hidden', 'false');

    // mettre le titre
    document.getElementById('details-title').innerText = title;

    // placeholder — remplaces par fetch vers ton backend quand prêt
    const placeholder = `
        <div class="medoc-item"><b>Doliprane</b> – 08:00<br>Quantité : 1<br>Compartiment : 2</div>
        <div class="medoc-item"><b>Ibuprofène</b> – 14:00<br>Quantité : 1<br>Compartiment : 1</div>
    `;

    // injecter le contenu
    document.getElementById('details-content').innerHTML = placeholder;
}

        // rendu initial
        renderCalendar(month, year);
    </script>
</div>

-->